---
title: |-
  Execution commands
pagenum: 26
prev_page:
  url: /reana/workflow_setup.html
next_page:
  url: /reana/mlflow.html
suffix: .md
search: reana workflow yadage workflows images png bash file yml successfully uploaded mm local server command run instance client files remote export madminer output institution steps port deployment sub folder set only terminal also environment cli access here reanaserverurl username ph ml workspace logs execution commands complete makefile defines high level within l cluster however variables source virtualenvs bin activate reanaaccesstoken reanaworkon check version status case installed locally same dev input browser ssh specification view plot plotting generate makes reference coordinator both well repositories few convenience main exposes specified generating results invisible accessible via ide cd ls section describes executing running

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Execution commands</div>
</div>
    
<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Execution-commands">Execution commands<a class="anchor-link" href="#Execution-commands"> </a></h1><h2 id="Local-deployment">Local deployment<a class="anchor-link" href="#Local-deployment"> </a></h2><p>The local deployment makes reference to the use of Yadage as the execution coordinator.</p>
<p>Both the complete workflow as well as the sub-workflow repositories have a <code>Makefile</code> that defines a few high-level commands for convenience. The main command that it exposes is the <code>yadage-run</code> command:</p>
<div class="highlight"><pre><span></span>make yadage-run
</pre></div>
<p>This command would run the specified workflow within the <code>workflow</code> folder, generating a set of results within the .yadage folder (invisible folder only accessible via terminal or IDE).</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> .yadage
ls -l
</pre></div>
<h2 id="Remote-deployment">Remote deployment<a class="anchor-link" href="#Remote-deployment"> </a></h2><p>This section describes executing the workflow on a REANA instance running on a remote cluster.</p>
<p>The <code>Makefile</code> in the complete workflow repository also defines a high-level command for submitting the job to a REANA cluster (the sub-workflows do not). 
However, one must first set some environment variables  in order for the <code>reana-client</code> CLI to be able to connect with a REANA instance:</p>
<div class="highlight"><pre><span></span><span class="c1"># Optional. Only if a virtual env was created</span>
<span class="nb">source</span> ~/.virtualenvs/reana/bin/activate

<span class="nb">export</span> <span class="nv">REANA_ACCESS_TOKEN</span><span class="o">=</span>“&lt;your access token here&gt;”
<span class="nb">export</span> <span class="nv">REANA_SERVER_URL</span><span class="o">=</span>“&lt;the REANA instance URL here&gt;”
<span class="nb">export</span> <span class="nv">REANA_WORKON</span><span class="o">=</span>madminer-workflow
</pre></div>
<p>To determine if the connection is established check the following output</p>
<div class="highlight"><pre><span></span>reana-client ping
</pre></div>

<pre><code>REANA server: &lt;REANA_URL_SERVER&gt;
REANA server version: 0.7.1
REANA client version: 0.7.2
Authenticated as: &lt;username&gt; &lt;username@institution&gt;
Status: Connected</code></pre>
<!--
There is, however, a shortcut in the case that the REANA instance has been installed locally in the same computer where the workflow has been cloned. Only in those cases, users could use the reana-dev CLI tool to automatically set up some environment variables for them.

```bash
# Mandatory, as REANA was installed locally
source ~/.virtualenvs/reana/bin/activate

eval $(reana-dev client-setup-environment)
export REANA_WORKON=madminer-workflow
```
-->

<p>Finally, and on the same terminal window, run:</p>
<div class="highlight"><pre><span></span>make reana-run
</pre></div>
<p>You should see an output similar to this</p>

<pre><code>Copying sub-workflows...
Deploying on REANA...
madminer-workflow.1
File /ph/input.yml was successfully uploaded.
File /ph/yadage/steps.yml was successfully uploaded.
File /ph/yadage/workflow.yml was successfully uploaded.
File /ml/input.yml was successfully uploaded.
File /ml/yadage/steps.yml was successfully uploaded.
File /ml/yadage/workflow.yml was successfully uploaded.
File /workflow.yml was successfully uploaded.
madminer-workflow has been queued</code></pre>
<h2 id="Local-monitoring-of-remote-workflows">Local monitoring of remote workflows<a class="anchor-link" href="#Local-monitoring-of-remote-workflows"> </a></h2><p>If we have access to a remote REANA server instance, it is more helpful to monitor the workflows and retrieve output files from the local browser than from the working directory at the cluster’s institution.  Here are the steps to do it:</p>
<div class="highlight"><pre><span></span><span class="c1">#local terminal, ssh to the institution hosting the REANA server</span>
ssh -q -L &lt;port&gt;:&lt;REANA_SERVER_URL&gt;:&lt;port&gt; &lt;username&gt;@&lt;institution&gt;
<span class="c1">#if the previous command brings you to a bastion, go ahead and login to your workspace</span>
</pre></div>
<p>In the case of Brookhaven National Lab, the REANA server is located at</p>

<pre><code>REANA_SERVER_URL=”https://kubmaster01.sdcc.bnl.gov:30443” (port=30443)
REANA_ACCESS_TOKEN contact with admin</code></pre>
<p>You can now check the progress of your workflows in <code>https://localhost:&lt;port&gt;</code> on your local browser and download output files. Congratulations!</p>
<h2 id="Example-screenshots">Example screenshots<a class="anchor-link" href="#Example-screenshots"> </a></h2><p>The list of REANA workflows that have been submitted and their status:
<img src="../images/mm-reana-workflows.png" alt=""></p>
<p>The specification for one of the workflows:
<img src="../images/mm-reana-specification.png" alt=""></p>
<p>The files produced in the workflow and stored in the workflow's workspace
<img src="../images/mm-reana-workspace.png" alt=""></p>
<p>You can access individual files either from the web interface or with the <code>reana-client</code> CLI
<img src="../images/mm-reana-outputfile.png" alt=""></p>
<p>You can also directly view some files, like this plot:</p>
<p><img src="../images/mm-reana-logs-plotting.png" alt=""></p>
<p>You can also inspect the logs for different steps in the workflow (eg. generate and plotting below)</p>
<p><img src="../images/mm-reana-logs-generate.png" alt=""></p>
<p><img src="../images/mm-reana-plot.png" alt=""></p>
<p>And if you have an MLFlow tracking server runnning, you can view the metrics and artifacts being tracked</p>
<p><img src="../images/mlflow_screenshot.png" alt=""></p>

</div>
</div>
</div>
</div>

 


    </main>
    